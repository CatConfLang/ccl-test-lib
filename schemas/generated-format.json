{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "ccl-test-current-flat-format",
  "title": "CCL Test Current Flat Format",
  "description": "Schema for existing generated flat test files (*-flat.json)",
  "type": "array",
  "minItems": 1,
  "items": {
    "type": "object",
    "required": ["name", "input", "validation", "expected", "behaviors", "variants", "features"],
    "properties": {
      "name": {
        "type": "string",
        "description": "Unique test name (source_name + validation function)",
        "pattern": "^[a-zA-Z0-9_]+$"
      },
      "input": {
        "type": "string",
        "description": "CCL input text to be tested"
      },
      "validation": {
        "type": "string",
        "description": "Single CCL function to validate",
        "enum": [
          "parse", "parse_value", "filter", "compose", "expand_dotted",
          "build_hierarchy", "get_string", "get_int", "get_bool", "get_float", "get_list",
          "pretty_print", "load", "round_trip", "canonical_format", "associativity"
        ]
      },
      "expected": {
        "type": "object",
        "description": "Expected result in standardized format",
        "required": ["count"],
        "properties": {
          "count": {
            "type": "integer",
            "description": "Number of expected results/assertions",
            "minimum": 0
          },
          "entries": {
            "type": "array",
            "description": "Expected entries for parse functions",
            "items": {
              "type": "object",
              "required": ["key", "value"],
              "properties": {
                "key": {"type": "string"},
                "value": {"type": "string"}
              },
              "additionalProperties": false
            }
          },
          "object": {
            "description": "Expected object for hierarchy functions"
          },
          "value": {
            "description": "Expected single value for typed access functions"
          },
          "list": {
            "type": "array",
            "description": "Expected list for list access functions"
          },
          "error": {
            "type": "boolean",
            "description": "Whether this should produce an error",
            "default": false
          }
        },
        "additionalProperties": false
      },
      "args": {
        "type": "array",
        "description": "Optional arguments for parameterized functions",
        "items": {
          "type": "string"
        }
      },
      "functions": {
        "type": "array",
        "description": "CCL functions tested by this test",
        "items": {
          "type": "string",
          "enum": [
            "parse", "parse_value", "filter", "compose", "expand_dotted",
            "build_hierarchy", "get_string", "get_int", "get_bool", "get_float", "get_list",
            "pretty_print", "load", "canonical_format", "round_trip", "associativity"
          ]
        }
      },
      "behaviors": {
        "type": "array",
        "description": "Implementation behavior choices",
        "items": {
          "type": "string",
          "enum": [
            "boolean_strict", "boolean_lenient",
            "crlf_preserve_literal", "crlf_normalize_to_lf",
            "tabs_preserve", "tabs_to_spaces",
            "strict_spacing", "loose_spacing",
            "list_coercion_enabled", "list_coercion_disabled"
          ]
        },
        "uniqueItems": true
      },
      "variants": {
        "type": "array",
        "description": "Specification variants",
        "items": {
          "type": "string",
          "enum": ["proposed_behavior", "reference_compliant"]
        },
        "uniqueItems": true
      },
      "features": {
        "type": "array",
        "description": "Required language features",
        "items": {
          "type": "string",
          "enum": [
            "comments", "empty_keys", "experimental_dotted_keys",
            "multiline", "unicode", "whitespace"
          ]
        },
        "uniqueItems": true
      },
      "conflicts": {
        "type": ["object", "null"],
        "description": "Mutually exclusive options by category",
        "properties": {
          "functions": {
            "type": "array",
            "items": {"type": "string"}
          },
          "behaviors": {
            "type": "array",
            "items": {"type": "string"}
          },
          "variants": {
            "type": "array",
            "items": {"type": "string"}
          },
          "features": {
            "type": "array",
            "items": {"type": "string"}
          }
        },
        "additionalProperties": false
      },
      "requires": {
        "type": "array",
        "description": "Functions that must be implemented as prerequisites",
        "items": {
          "type": "string"
        }
      },
      "level": {
        "type": "integer",
        "description": "CCL implementation level (1-5)",
        "minimum": 1,
        "maximum": 5
      },
      "source_test": {
        "type": "string",
        "description": "Original source test name for traceability"
      },
      "expect_error": {
        "type": "boolean",
        "description": "Whether this test should produce an error",
        "default": false
      },
      "error_type": {
        "type": "string",
        "description": "Expected error type for error tests"
      }
    },
    "additionalProperties": false
  }
}